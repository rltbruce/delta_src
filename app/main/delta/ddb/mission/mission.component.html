<div class="page-layout simple tabbed">

    <!-- HEADER -->
    <div class="header accent p-24 h-20" fxLayout="row" fxLayoutAlign="start center">
        <h1>Contrats et missions des Clients</h1>
    </div>
    <!-- / HEADER -->

    <!-- CONTENT -->
    <div class="content">

        <mat-tab-group dynamicHeight="true" (selectedTabChange)="changetab($event)">

            <mat-tab label="Client">
                <div class="p-24">
                    
                        <!--form name="clientForm" [formGroup]="clientForm" novalidate fxLayout="column" fxLayoutAlign="center left" fxLayout.xs="row">
                            <mat-form-field  fxFlex="100" class="pl-4" appearance="outline" fxFlex style="width:320px;margin-top:10px;height:20px;">
                                <mat-label>Client</mat-label>
                            
                                <mat-select (selectionChange)="changeclient($event)" formControlName="id" required>
                                   
                                    <mat-option *ngFor="let grd of row_client" [value]="grd.id">
                                        {{grd.nom_client}}
                                    </mat-option>
                                 </mat-select>   
                            </mat-form-field>
                        </form--> 

                        <ngx-datatable
                       
                        class="material"
                        [rows]="row_client"
                        [loadingIndicator]="loadingIndicator"
                        [columns]="columns_c"
                        [columnMode]="'force'"
                        [headerHeight]="48"
                        [footerHeight]="50"
                        [rowHeight]="'auto'"
                       
                        [reorderable]="reorderable"
                        [selected]="selected_c"
                        [selectionType]="'single'"
                        
                        (select)='onSelectClient($event)'
                        
                        [limit]="10"
                       >

                      
                        
                     
                        <!--ngx-datatable-column name="Code" fxFlex="30" fxFlex style="width:120px;">
                            <ng-template let-row="row" ngx-datatable-cell-template>
                              {{row.num_contrat}}
                            </ng-template>
                          </ngx-datatable-column>
                        
                          <ngx-datatable-column name="Date du contrat" fxFlex="70" fxFlex style="width:620px;">
                            <ng-template let-row="row" ngx-datatable-cell-template>
                               {{row.date_contrat}}
                            </ng-template>
                          </ngx-datatable-column--> 
                          <ngx-datatable-column name="Code" prop="code"></ngx-datatable-column>
                          <ngx-datatable-column name="Nom client" prop="nom_client"></ngx-datatable-column>  
                        
                         

                    </ngx-datatable>

                  
                </div>
            </mat-tab>

            <mat-tab label="Contrats">
                <div class="p-2">
                    <!--button mat-raised-button type="button" color="accent" (click)="ajouter()" style="width: 10%;">
                        Nouveau
                    </button-->
                    <button  matTooltip="Ajouter" (click)="ajouter()"  class="ml-4" style="width: 10%;">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier()" *ngIf="afficherboutonModifSupr" class="ml-4" style="width: 10%;">
                    <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer()" *ngIf="afficherboutonModifSupr" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    
                    <span style="margin-left: 400px;"><strong>Client :{{nomclient}}</strong></span>
                    <!--button mat-raised-button type="button" color="primary" (click)="modifier()" *ngIf="afficherboutonModifSupr" class="ml-4" style="width: 10%;">
                        Modifier
                    </button-->
              
              
                    <!--button mat-raised-button type="button" color="warn" (click)="supprimer()" *ngIf="afficherboutonModifSupr" class="ml-4" style="width: 10%;">
                        Supprimer
                    </button-->
                </div>
                <div class="p-4">
                   
                        <ngx-datatable
                       
                         class="material"
                         [rows]="row_type"
                         [loadingIndicator]="loadingIndicator"
                         [columns]="columns"
                         [columnMode]="'force'"
                         [headerHeight]="48"
                         [footerHeight]="50"
                         [rowHeight]="'auto'"
                        
                         [reorderable]="reorderable"
                         [selected]="selected"
                         [selectionType]="'single'"
                         
                         (select)='onSelectcontrat($event)'
                         [limit]="10"
                         style="margin-top:2px;margin-bottom:5px;"
                        >

                       
                         
                      
                         <ngx-datatable-column name="Code" fxFlex="30" fxFlex style="width:120px;">
                             <ng-template let-row="row" ngx-datatable-cell-template>
                               {{row.num_contrat}}
                             </ng-template>
                           </ngx-datatable-column>
                           <ngx-datatable-column name="Libelle" fxFlex="30" fxFlex style="width:200px;">
                            <ng-template let-row="row" ngx-datatable-cell-template>
                              {{row.libelle}}
                            </ng-template>
                          </ngx-datatable-column>
                         
                           <ngx-datatable-column name="Date du contrat" fxFlex="70" fxFlex style="width:620px;">
                             <ng-template let-row="row" ngx-datatable-cell-template>
                                {{row.date_contrat|date:'dd/MM/yyyy'}}
                             </ng-template>
                           </ngx-datatable-column>
                           <ngx-datatable-column name="Debut du contrat" fxFlex="70" fxFlex style="width:620px;">
                            <ng-template let-row="row" ngx-datatable-cell-template>
                               {{row.date_debut|date:'dd/MM/yyyy'}}
                            </ng-template>
                          </ngx-datatable-column> 
                          <ngx-datatable-column name="Fin du contrat" fxFlex="70" fxFlex style="width:620px;">
                            <ng-template let-row="row" ngx-datatable-cell-template>
                               {{row.date_fin|date:'dd/MM/yyyy'}}
                            </ng-template>
                          </ngx-datatable-column>  
                           <!--ngx-datatable-column name="Code" prop="num_contrat"></ngx-datatable-column>
                           <ngx-datatable-column name="Date_contrat" prop="date_contrat"></ngx-datatable-column-->  
                         
                          

                     </ngx-datatable>
                  
                </div>
            </mat-tab>

            <mat-tab label="Missions">
                <div class="p-4">
                   
                    <button  matTooltip="Ajouter" (click)="ajouter_produit()"  class="ml-4" style="width: 10%;">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier_produit()"  class="ml-4" *ngIf="afficherboutonproduit" class="ml-4" style="width: 10%;">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer_produit()"  class="ml-4" *ngIf="afficherboutonproduit" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <span style="margin-left: 400px;"><strong>Client :{{nomclient}}  </strong></span>
                    <span ><strong>     Contrat :{{numcontrat}}</strong></span>
                </div>
                <div class="p-4">
                    <ngx-datatable
                           #table
                            class="material"
                            [rows]="row_prd"
                            [loadingIndicator]="loadingIndicator"
                            [columns]="columns_m"
                            [columnMode]="'force'"
                            [headerHeight]="5"
                            [footerHeight]="25"
                            [rowHeight]="'35'"
                         
                            [reorderable]="reorderable"
                            [selected]="selected_m"
                            [selectionType]="'single'"
                            (activate)="onActivate($event)"
                            (select)='onSelectmission($event)'
                           >
                            
                         
                            <ngx-datatable-column name="Code">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                  {{row.code}}
                                </ng-template>
                              </ngx-datatable-column>
                            
                              <ngx-datatable-column name="Libellé">
                                <ng-template let-row="row" ngx-datatable-cell-template>
                                   {{row.libelle}}
                                </ng-template>
                              </ngx-datatable-column>   
                             
                             

                        </ngx-datatable>
                </div>
            </mat-tab>

        </mat-tab-group>
        <mat-tab-group dynamicHeight="true" (selectedTabChange)="changetab1($event)">

            <mat-tab label="Previsions honoraires">
                <div class="p-4">
                   
                    <button  matTooltip="Ajouter" (click)="ajouter_honoraire()"  class="ml-4" style="width: 10%;" *ngIf="!editprevhn">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier_honoraire()"  class="ml-4" *ngIf="afficherboutonhonoraire && !editprevhn" class="ml-4" style="width: 10%;">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer_honoraire()"  class="ml-4" *ngIf="afficherboutonhonoraire && !editprevhn" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button  matTooltip="Sauver" [disabled]="test_honoraire(selected_phn[0])" (click)="ajout_honoraire(debours,0)"  class="ml-4" *ngIf="editprevhn" class="ml-4" style="width: 10%;">
                        <mat-icon>save</mat-icon>
                    </button>
                    <button  matTooltip="Annuler"  (click)="annuler_honoraire()"  class="ml-4" *ngIf="editprevhn" class="ml-4" style="width: 10%;">
                        <mat-icon>cancel</mat-icon>
                    </button>
                  
                </div>
                <div class="p-4">
                    <ngx-datatable
                    #table
                     class="material"
                     [rows]="row_prevhn"
                     [loadingIndicator]="loadingIndicator"
                     [columns]="columns_hn"
                     [columnMode]="'force'"
                     [headerHeight]="5"
                     [footerHeight]="25"
                     [rowHeight]="'35'"
                     [reorderable]="reorderable"
                     [selected]="selected_phn"
                     [selectionType]="'single'"
                     [footerHeight]="50"
                     (activate)="onActivate($event)"
                     (select)='onSelecthonoraire($event)'                           
                    >
                     
                  
                     <ngx-datatable-column name="Intervenants" [maxWidth]="200" [minWidth]="180" [width]="400" >
                         <ng-template let-row="row" ngx-datatable-cell-template>
                            <span *ngIf="!row.edit">
                           {{row.libgrade}}
                           </span>
                           <span *ngIf="row.edit">
                            <mat-select (selectionChange)="changegrade($event)"  [(ngModel)]="row.grade"  style="min-width:150px;max-width:700px" required>
                          
                                <mat-option *ngFor="let grd of rows_grade" [value]="grd.id">
                                    {{grd.libelle}}
                                </mat-option>
                             </mat-select>   
                           </span>
                         </ng-template>
                       </ngx-datatable-column>
                     
                       <ngx-datatable-column name="Nombre jour" fxFlex="30" class="pl-4"  fxFlex [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row"  ngx-datatable-cell-template>
                             <span *ngIf="!row.edit">
                            {{row.nbre_jour}}
                            </span>
                            <span *ngIf="row.edit">
                                
                                <input  type="number" name="Nombre jour" [(ngModel)]="row.nbre_jour" 
                                 (ngModelChange)="changejour()" placeholder="Nombre jour"  appearance="outline" class="pl-4"
                                 style="min-width:30px;max-width:80px" required>
                             </span>
                         </ng-template>
                       </ngx-datatable-column>
                         
                       <ngx-datatable-column name="Jour/Homme" fxFlex="30" class="pl-4" style="width:120px" [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           
                            <span *ngIf="!row.edit">
                                {{row.nbre_homme}}
                            </span>
                            <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Nombre Homme" [(ngModel)]="row.nbre_homme" 
                                     placeholder="Nombre homme"  appearance="outline" class="pl-4"
                                     (ngModelChange)="changejour()" style="min-width:30px;max-width:80px" required>
                            </span>
                         </ng-template>
                       </ngx-datatable-column>
                       
                       <ngx-datatable-column name="Nombre heure" style="width:120px" [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                            
                            <span *ngIf="!row.edit">
                                {{row.nbre_heure}}
                            </span>
                            <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Nombre Heure" [(ngModel)]="row.nbre_heure" 
                                     placeholder="Nombre heure"  appearance="outline" class="pl-4"
                                     style="min-width:30px;max-width:80px" required>
                            </span>
                         </ng-template>
                       </ngx-datatable-column>  
                       
                       <ngx-datatable-column name="Duree totale" style="width:120px" [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                            {{row.nbre_jour*row.nbre_homme}}
                         </ng-template>
                       </ngx-datatable-column>  
                       <ngx-datatable-column name="Prix Unitaire" [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row" ngx-datatable-cell-template   >
                           
                            <span *ngIf="!row.edit" >
                                
                                {{(row.pu*1)|number }}
                           
                            </span>
                            <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Prix Unitaire" [(ngModel)]="row.pu" 
                                    (ngModelChange)="changejour()" placeholder="Prix unitaire"  appearance="outline" class="pl-4"
                                    style="min-width:30px;max-width:120px" required>
                            </span>
                         </ng-template>
                       </ngx-datatable-column>
                      
                       <ngx-datatable-column name="Montant total" [cellClass]="'textalg'" [headerClass]="'textright'" [maxWidth]="150" [minWidth]="120">
                         <ng-template let-row="row" ngx-datatable-cell-template >
                            {{(row.pu*row.nbre_homme*row.nbre_jour)|number }}
                         </ng-template>
                       </ngx-datatable-column>
                       <!--a *ngIf="editprevhn" ng-click="vm.sauverDetail(avancement,0)">
                        <span class="icon-content-save"></span>
                        </a-->
                       
                       <ngx-datatable-footer *ngIf="true" [cellClass]="'textalg'">
                         <ng-template
                           ngx-datatable-footer-template
                           let-rowCount="rowCount"
                           let-pageSize="pageSize"
                           let-selectedCount="selectedCount"
                           let-curPage="curPage"
                           let-offset="offset"
                         >
                           <div style="margin-left:970px;!important">
                             <div><strong>{{somme|number}} </strong></div>
                             <hr style="width:100%" />
                            
                           </div>
                         </ng-template>
                       </ngx-datatable-footer>
                       

                 </ngx-datatable>   
                 
               

                </div>    
            </mat-tab>
            <mat-tab label="Previsions Debours">
                <div class="p-4">
                   
                    <button  matTooltip="Ajouter" (click)="ajouter_debours()"  class="ml-4" style="width: 10%;" *ngIf="!editprevdeb">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier_debours()"  class="ml-4" *ngIf="afficherboutonprevdeb && !editprevdeb" class="ml-4" style="width: 10%;">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer_debours()"  class="ml-4" *ngIf="afficherboutonprevdeb && !editprevdeb" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button  matTooltip="Sauver" [disabled]="test_debours(selected_pdeb[0])" (click)="ajout_prevdebours(debours,0)"  class="ml-4" *ngIf="editprevdeb" class="ml-4" style="width: 10%;">
                        <mat-icon>save</mat-icon>
                    </button>
                    <button  matTooltip="Annuler"  (click)="annuler_debours()"  class="ml-4" *ngIf="editprevdeb" class="ml-4" style="width: 10%;">
                        <mat-icon>cancel</mat-icon>
                    </button>
                  
                </div>
                <div class="p-24">
                    <ngx-datatable
                    #table
                     class="material"
                     [rows]="row_prevdeb"
                     [loadingIndicator]="loadingIndicator"
                     [columns]="columns_deb"
                     [columnMode]="'force'"
                     [headerHeight]="5"
                     [footerHeight]="25"
                     [rowHeight]="'35'"
                     [reorderable]="reorderable"
                     [selected]="selected_pdeb"
                     [selectionType]="'single'"
                     [footerHeight]="50"
                     (activate)="onActivate($event)"
                     (select)='onSelectprevdebours($event)'                           
                    >
                     
                  
                     <ngx-datatable-column name="Debours">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           
                           <span *ngIf="!row.edit">
                            {{row.libdebours}}
                            </span>
                            <span *ngIf="row.edit">
                             <mat-select (selectionChange)="changedebours($event)"  [(ngModel)]="row.id_debours"  style="min-width:150px;max-width:700px" required>
                           
                                 <mat-option *ngFor="let deb of rows_debours" [value]="deb.id">
                                     {{deb.libelle}}
                                 </mat-option>
                              </mat-select>   
                            </span>
                         </ng-template>
                       </ngx-datatable-column>
                     
                       <ngx-datatable-column name="Nombre jour" fxFlex="30" class="pl-4"  fxFlex style="width:120px;" [cellClass]="'textalg'" [headerClass]="'textright'">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                         
                            <span *ngIf="!row.edit">
                                {{row.nbre_jours}}
                                </span>
                                <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Nombre jour" [(ngModel)]="row.nbre_jours" 
                                    (ngModelChange)="changedeb()"  placeholder="Nombre jour"  appearance="outline" class="pl-4"
                                     style="min-width:30px;max-width:80px" required>
                                 </span>
                         </ng-template>
                       </ngx-datatable-column> 
                       <ngx-datatable-column name="Prix unitaire" [cellClass]="'textalg'" [headerClass]="'textright'" fxFlex="30" class="pl-4" style="width:120px">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           
                            <span *ngIf="!row.edit">
                                {{row.pu|number}}
                                </span>
                                <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Nombre jour" [(ngModel)]="row.pu" 
                                     (ngModelChange)="changedeb()" placeholder="Prix unitaire"  appearance="outline" class="pl-4"
                                     style="min-width:30px;max-width:100px" required>
                                 </span>
                         </ng-template>
                       </ngx-datatable-column>
                      
                       <ngx-datatable-column name="Montant total" style="width:120px" [cellClass]="'textalg'" [headerClass]="'textright'">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                            {{row.nbre_jours*row.pu|number}}
                         </ng-template>
                       </ngx-datatable-column>  
                      
                      
                      
                       <ngx-datatable-footer *ngIf="true">
                         <ng-template
                           ngx-datatable-footer-template
                           let-rowCount="rowCount"
                           let-pageSize="pageSize"
                           let-selectedCount="selectedCount"
                           let-curPage="curPage"
                           let-offset="offset"
                         >
                           <div style="margin-left:940px;!important">
                             <div><strong>{{sommedeb|number}} </strong></div>
                             <hr style="width:100%" />
                            
                           </div>
                         </ng-template>
                       </ngx-datatable-footer>
                       

                 </ngx-datatable>   
                </div>    
            </mat-tab> 
            <mat-tab label="Echeance de paiement">
                <div class="p-4">
                   
                    <button  matTooltip="Ajouter" (click)="ajouter_echeance()"  class="ml-4" style="width: 10%;" *ngIf="!editech">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier_echeance()"  class="ml-4" *ngIf="afficherboutonech && !editech" class="ml-4" style="width: 10%;">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer_echeance()"  class="ml-4" *ngIf="afficherboutonech && !editech" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button  matTooltip="Sauver" [disabled]="test_echeance(selected_pech[0])" (click)="ajout_echeance(debours,0)"  class="ml-4" *ngIf="editech" class="ml-4" style="width: 10%;">
                        <mat-icon>save</mat-icon>
                    </button>
                    <button  matTooltip="Annuler"  (click)="annuler_echeance()"  class="ml-4" *ngIf="editech" class="ml-4" style="width: 10%;">
                        <mat-icon>cancel</mat-icon>
                    </button>
                  
                </div>
                <div class="p-24">
                    <ngx-datatable
                    #table
                     class="material"
                     [rows]="row_echeance"
                     [loadingIndicator]="loadingIndicator"
                     [columns]="columns_deb"
                     [columnMode]="'force'"
                     [headerHeight]="5"
                     [footerHeight]="25"
                     [rowHeight]="'35'"
                     [reorderable]="reorderable"
                     [selected]="selected_pech"
                     [selectionType]="'single'"
                     [footerHeight]="50"
                     (activate)="onActivate($event)"
                     (select)='onSelectecheance($event)'                           
                    >
                     
                  
                     <ngx-datatable-column name="Libelle">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           
                           <span *ngIf="!row.edit">
                            {{row.libelle}}
                            </span>
                            <span *ngIf="row.edit">
                                    
                                <input  type="text" name="Libellé" [(ngModel)]="row.libelle" 
                                (ngModelChange)="changedeb()"  placeholder="Libelle"  appearance="outline" class="pl-4"
                                 style="min-width:30px;max-width:180px" required>
                             </span>
                         </ng-template>
                       </ngx-datatable-column>
                     
                       <ngx-datatable-column name="Pourcentage" fxFlex="30" class="pl-4"  fxFlex style="width:120px;" [cellClass]="'textalg'" [headerClass]="'textright'">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                         
                            <span *ngIf="!row.edit">
                                {{row.pourcentage}}
                                </span>
                                <span *ngIf="row.edit">
                                    
                                    <input  type="number" name="Pourcentage" [(ngModel)]="row.pourcentage" 
                                    (ngModelChange)="changedeb()"  placeholder="Pourcentage"  appearance="outline" class="pl-4"
                                     style="min-width:30px;max-width:80px" required>
                                 </span>
                         </ng-template>
                       </ngx-datatable-column> 
                       <ngx-datatable-column name="Nombre jour" fxFlex="30" class="pl-4"  fxFlex style="width:120px;" [cellClass]="'textalg'" [headerClass]="'textright'">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                        
                           <span *ngIf="!row.edit">
                               {{row.nbre_jours}}
                               </span>
                               <span *ngIf="row.edit">
                                   
                                   <input  type="number" name="Nombre jours" [(ngModel)]="row.nbre_jours" 
                                   (ngModelChange)="changedeb()"  placeholder="Nombre jours"  appearance="outline" class="pl-4"
                                    style="min-width:30px;max-width:80px" required>
                                </span>
                        </ng-template>
                      </ngx-datatable-column> 
                       <ngx-datatable-column name="Date prevue facture" [cellClass]="'textalg'" [headerClass]="'textright'" fxFlex="30" class="pl-4" style="width:150px">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           
                            <span *ngIf="!row.edit">
                                {{row.date_facture}}
                                </span>
                                <span *ngIf="row.edit">
                                    
                                    <input  type="date" name="Date facture" [(ngModel)]="row.date_facture" 
                                     (ngModelChange)="changedeb()" placeholder="Prix unitaire"  appearance="outline" class="pl-4"
                                     style="min-width:30px;max-width:150px" required>
                                 </span>
                         </ng-template>
                       </ngx-datatable-column>
                      
                       
                      
                      
                      
                       

                 </ngx-datatable>   
                </div>    
            </mat-tab>     
            <mat-tab label="Previsions Sections">
                <div class="p-4">
                   
                    <button  matTooltip="Ajouter" (click)="ajouter_section()"  class="ml-4" style="width: 10%;" *ngIf="!editsec">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button  matTooltip="Modifier" (click)="modifier_section()"  class="ml-4" *ngIf="afficherboutonsec && !editsec" class="ml-4" style="width: 10%;">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button  matTooltip="Supprimer" (click)="supprimer_section()"  class="ml-4" *ngIf="afficherboutonsec && !editsec" class="ml-4" style="width: 10%;">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button  matTooltip="Sauver" [disabled]="test_section(selected_psec[0])" (click)="ajout_section(debours,0)"  class="ml-4" *ngIf="editsec" class="ml-4" style="width: 10%;">
                        <mat-icon>save</mat-icon>
                    </button>
                    <button  matTooltip="Annuler"  (click)="annuler_section()"  class="ml-4" *ngIf="editsec" class="ml-4" style="width: 10%;">
                        <mat-icon>cancel</mat-icon>
                    </button>
                  
                </div>
                <div class="p-4">
                    <ngx-datatable
                    #table
                     class="material"
                     [rows]="row_prevsec"
                     [loadingIndicator]="loadingIndicator"
                     [columns]="columns_sec"
                     [columnMode]="'force'"
                     [headerHeight]="5"
                     [footerHeight]="25"
                     [rowHeight]="'35'"
                     [reorderable]="reorderable"
                     [selected]="selected_psec"
                     [selectionType]="'single'"
                     [footerHeight]="50"
                     (activate)="onActivate($event)"
                     (select)='onSelectsection($event)'                           
                    >
                     
                  
                     <ngx-datatable-column name="Section">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                          <span *ngIf="!row.edit">
                            {{row.libsection}}
                          </span>  
                           <span *ngIf="row.edit">
                            <mat-select (selectionChange)="changedebours($event)"  [(ngModel)]="row.grand_tache"  style="min-width:200px;max-width:300px" required>
                          
                                <mat-option *ngFor="let deb of rows_section" [value]="deb.id">
                                    {{deb.libelle}}
                                </mat-option>
                             </mat-select>   
                           </span>
                         </ng-template>
                       </ngx-datatable-column>
                     
                       <ngx-datatable-column name="Nombre heure" fxFlex="30" class="pl-4"  fxFlex style="width:120px;">
                         <ng-template let-row="row" ngx-datatable-cell-template>
                           <span *ngIf="!row.edit">
                            {{row.nbre_heure}}
                            </span>
                            <span *ngIf="row.edit">
                                <input  type="number" name="Nombre heure" [(ngModel)]="row.nbre_heure" 
                                (ngModelChange)="changedeb()"  placeholder="Nombre heure"  appearance="outline" class="pl-4"
                                 style="min-width:30px;max-width:80px" required>
                            </span>    
                         </ng-template>
                       </ngx-datatable-column> 
                     
                      
                      
                      
                      
                      
                       <!--ngx-datatable-footer *ngIf="true">
                         <ng-template
                           ngx-datatable-footer-template
                           let-rowCount="rowCount"
                           let-pageSize="pageSize"
                           let-selectedCount="selectedCount"
                           let-curPage="curPage"
                           let-offset="offset"
                         >
                           <div style="margin-left:883px;!important">
                             <div><strong>Total: {{somme|number}} </strong></div>
                             <hr style="width:100%" />
                            
                           </div>
                         </ng-template>
                       </ngx-datatable-footer-->
                       

                 </ngx-datatable>   
                </div>    
            </mat-tab>    
        </mat-tab-group>    
        <div class="p-24">
            <ng-template #suppressionDialog>
                <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement produit?</h2>
                <mat-dialog-content>      
                  
                </mat-dialog-content>
                <mat-dialog-actions align="end">
                  <button mat-button matDialogClose color="primary" (click)="suppressionConfirmer_produit()">Ok</button>
                  <button mat-button matDialogClose color="primary">Fermer</button>
                </mat-dialog-actions>
              </ng-template>
              <ng-template #suppressionDialoghn>
                <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement honoraire?</h2>
                <mat-dialog-content>      
                  
                </mat-dialog-content>
                <mat-dialog-actions align="end">
                  <button mat-button matDialogClose color="primary" (click)="suppressionConfirmer_honoraire()">Ok</button>
                  <button mat-button matDialogClose color="primary">Fermer</button>
                </mat-dialog-actions>
              </ng-template>

              <ng-template #suppressionDialogdeb>
                <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement debours?</h2>
                <mat-dialog-content>      
                  
                </mat-dialog-content>
                <mat-dialog-actions align="end">
                  <button mat-button matDialogClose color="primary" (click)="suppressionConfirmer_debours()">Ok</button>
                  <button mat-button matDialogClose color="primary">Fermer</button>
                </mat-dialog-actions>
              </ng-template>

              <ng-template #saisieDialog >
                <p><b>Formulaire du Contrat</b></p>
                <div class="divform" >
                    <form name="deboursForm" [formGroup]="deboursForm" novalidate fxLayout="column" fxLayoutAlign="center center" fxLayout.xs="row">
                      <div class="centerinput">
                        <input type="hidden" formControlName="id" [(ngModel)]="debours.id">
                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;" >
                            <mat-label>Numero du Contrat</mat-label>
                            <input matInput formControlName="num_contrat" [(ngModel)]="debours.num_contrat">
                            <mat-error>
                                Numero obligatoire
                            </mat-error>
                        </mat-form-field>
                       
                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;" >
                            <mat-label>Libellé du Contrat</mat-label>
                            <input matInput formControlName="libelle" [(ngModel)]="debours.libelle">
                            <mat-error>
                                Libelle obligatoire
                            </mat-error>
                        </mat-form-field>
                                     
            
                            
            
                          
            
            
            
                          </div>
                          <div>
                            <mat-form-field fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:250px;">
                                <mat-label>Date du contrat</mat-label>
                                <input matInput [matDatepicker]="picker" formControlName="date_contrat" [(ngModel)]="debours.date_contrat">
                                <mat-datepicker-toggle matSuffix [for]="picker">
                                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                                </mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                              </mat-form-field>
                              <mat-form-field fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:250px;">
                                <mat-label>Date de debut du contrat</mat-label>
                                <input matInput [matDatepicker]="picker1" formControlName="date_debut" [(ngModel)]="debours.date_debut">
                                <mat-datepicker-toggle matSuffix [for]="picker1">
                                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                                </mat-datepicker-toggle>
                                <mat-datepicker #picker1></mat-datepicker>
                              </mat-form-field>
                              <mat-form-field fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:250px;">
                                <mat-label>Date de la fin du contrat</mat-label>
                                <input matInput [matDatepicker]="picker2" formControlName="date_fin" [(ngModel)]="debours.date_fin">
                                <mat-datepicker-toggle matSuffix [for]="picker2">
                                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                                </mat-datepicker-toggle>
                                <mat-datepicker #picker2></mat-datepicker>
                              </mat-form-field>
                          </div>
                          <div>
                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;" >
                                <mat-label>Montant HT</mat-label>
                                <input type="number" matInput formControlName="montant_ht" [(ngModel)]="debours.montant_ht"  />
                                
                            </mat-form-field>
                           
                            
                             
            
                                <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;">
                                    <mat-label>Monnaie</mat-label>
                                    <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                    <mat-select (selectionChange)="changemonnaie($event)" formControlName="monnaie" [(ngModel)]="debours.monnaie" required>
                                        <!--mat-option [value]="'United States of America'">
                                            United States of America
                                        </mat-option-->
                                        <mat-option *ngFor="let grd of rows_monnaie" [value]="grd.id">
                                            {{grd.libelle}}
                                        </mat-option>
                                     </mat-select>   
                                </mat-form-field>
            
            
            
                          </div>
                          <!--div>
                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;">
                                <mat-label>Adresse</mat-label>
                                <input matInput formControlName="adresse" [(ngModel)]="debours.adresse">
                                
                            </mat-form-field>
                          </div-->
               </form>
            </div>
            <div fxLayout="row" fxLayoutAlign="start start">
                <button (click)="ajout(debours,0)" mat-raised-button color="accent" class="submit-button ml-4" aria-label="CREATE AN FORM"
                    [disabled]="deboursForm.invalid">
                    Enregistrer
                </button>
                <button (click)="annuler()" mat-raised-button color="primary" aria-label="ANNULER AN FORM" class="ml-4">
                    ANNULER
                </button>
            </div>
            
             </ng-template>
             <ng-template #missionDialog>
               
                <p><b>Formulaire des Missions</b></p>
                    <!--Debut-->
                    <div class="divform" >
                                       <form name="deboursForm2" [formGroup]="deboursForm2" novalidate fxLayout="column" fxLayoutAlign="center center" fxLayout.xs="row">
                                       <div class="centerinput">
                                               
                                           <input type="hidden" formControlName="id" [(ngModel)]="produit.id">
                                           <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;" >
                                               <mat-label>Code</mat-label>
                                               <input matInput formControlName="code" [(ngModel)]="produit.code">
                                               <mat-error>
                                                   Code obligatoire
                                               </mat-error>
                                           </mat-form-field>
            
                                           <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;" >
                                               <mat-label>Libellé</mat-label>
                                               <input matInput formControlName="libelle" [(ngModel)]="produit.libelle">
                                               <mat-error>
                                                   Libellé obligatoire
                                               </mat-error>
                                           </mat-form-field>
            
                                       </div>
                                       <div class="centerinput">
                                        <mat-form-field fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:380px;">
                                            <mat-label>Date debut de la mission</mat-label>
                                            <input matInput [matDatepicker]="pickerd" formControlName="date_deb_prevue" [(ngModel)]="produit.date_deb_prevue">
                                            <mat-datepicker-toggle matSuffix [for]="pickerd">
                                              <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #pickerd></mat-datepicker>
                                          </mat-form-field>
                                          <mat-form-field fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:380px;">
                                            <mat-label>Date fin de la mission</mat-label>
                                            <input matInput [matDatepicker]="pickerf" formControlName="date_fin_prevue" [(ngModel)]="produit.date_fin_prevue">
                                            <mat-datepicker-toggle matSuffix [for]="pickerf">
                                              <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                                            </mat-datepicker-toggle>
                                            <mat-datepicker #pickerf></mat-datepicker>
                                          </mat-form-field>
                                    </div>   
                                       <div>
                                       
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:340px;">
                                            <mat-label>Partners</mat-label>
                                            <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                            <mat-select (selectionChange)="changepers($event)" formControlName="associe_resp" [(ngModel)]="produit.associe_resp" required>
                                                <!--mat-option [value]="'United States of America'">
                                                    United States of America
                                                </mat-option-->
                                                <mat-option *ngFor="let pers of row_personnel" [value]="pers.id">
                                                    {{pers.nom}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field>
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:400px;">
                                            <mat-label>Associate Director</mat-label>
                                          
                                            <mat-select (selectionChange)="changepers($event)" formControlName="associate_director" [(ngModel)]="produit.associate_director">
                                              
                                                <mat-option *ngFor="let pers of row_personnel" [value]="pers.id">
                                                    {{pers.nom}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field>

                                       
                                        
                                      
                                       </div>
                                       <div class="centerinput">
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:320px;">
                                            <mat-label>Director</mat-label>
                                            
                                            <mat-select (selectionChange)="changepers($event)" formControlName="director" [(ngModel)]="produit.director">
                                               
                                                <mat-option *ngFor="let pers of row_personnel" [value]="pers.id">
                                                    {{pers.nom}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field>
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:420px;">
                                            <mat-label>Senior manager</mat-label>
                                            <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                            <mat-select (selectionChange)="changepers($event)" formControlName="senior_manager" [(ngModel)]="produit.senior_manager" required>
                                                <!--mat-option [value]="'United States of America'">
                                                    United States of America
                                                </mat-option-->
                                                <mat-option *ngFor="let pers of row_personnel" [value]="pers.id">
                                                    {{pers.nom}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field>     
                                       </div>
                                     <div>
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;">
                                            <mat-label>Chef de mission</mat-label>
                                            <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                            <mat-select (selectionChange)="changepers($event)" formControlName="chef_mission" [(ngModel)]="produit.chef_mission" required>
                                                <!--mat-option [value]="'United States of America'">
                                                    United States of America
                                                </mat-option-->
                                                <mat-option *ngFor="let pers of row_personnel" [value]="pers.id">
                                                    {{pers.nom}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field> 
                                        <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;">
                                            <mat-label>Produit</mat-label>
                                            <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                            <mat-select (selectionChange)="changegrade($event)" formControlName="produit" [(ngModel)]="produit.produit" required>
                                                <!--mat-option [value]="'United States of America'">
                                                    United States of America
                                                </mat-option-->
                                                <mat-option *ngFor="let prd of row_produit" [value]="prd.id">
                                                    {{prd.libelle}}
                                                </mat-option>
                                             </mat-select>   
                                        </mat-form-field> 
                                     </div>
                                                                      
                                      
                                         
                                       <div fxLayout="row" fxLayoutAlign="start start">
                                           <button (click)="ajout_produit(produit,0)" mat-raised-button color="accent" class="submit-button ml-4" aria-label="CREATE AN FORM"
                                               [disabled]="deboursForm2.invalid">
                                               Enregistrer
                                           </button>
                                           <button (click)="annuler_produit()" mat-raised-button color="primary" aria-label="ANNULER AN FORM" class="ml-4">
                                               ANNULER
                                           </button>
                                       </div>
                                       </form>
                                   </div>
                    <!--Fin-->
                   
                
             </ng-template>

             <ng-template #honoraireDialog>
                <p><b>Formulaire des Prévisions honoraires</b></p>
                <div class="divform" >
                    <form name="honoraireForm" [formGroup]="honoraireForm" novalidate fxLayout="column" fxLayoutAlign="center center" fxLayout.xs="row">
                        <div class="centerinput">
                                               
                            <input type="hidden" formControlName="id" [(ngModel)]="honoraire.id">
                            <!--mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;" >
                                <mat-label>Grade</mat-label>
                                <input matInput formControlName="grade" [(ngModel)]="honoraire.grade">
                                <mat-error>
                                    Grade obligatoire
                                </mat-error>
                            </mat-form-field-->

                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:520px;">
                                <mat-label>Grade</mat-label>
                                <!--input matInput formControlName="grade" [(ngModel)]="debours.grade"-->
                                <mat-select (selectionChange)="changegrade($event)" formControlName="grade" [(ngModel)]="honoraire.grade" required>
                                   
                                    <mat-option *ngFor="let grd of rows_grade" [value]="grd.id">
                                        {{grd.libelle}}
                                    </mat-option>
                                 </mat-select>   
                            </mat-form-field>


                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:220px;" >
                                <mat-label>Nombre Jours</mat-label>
                                <input matInput formControlName="nbre_jour" [(ngModel)]="honoraire.nbre_jour">
                                <mat-error>
                                    Nombre Jours obligatoire
                                </mat-error>
                            </mat-form-field>

                        </div>    
                        <div class="centerinput">
                                               
                            
                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:120px;" >
                                <mat-label>Nombre Jours/Homme</mat-label>
                                <input matInput formControlName="nbre_homme" [(ngModel)]="honoraire.nbre_homme">
                                <mat-error>
                                    Nombre Homme obligatoire
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;" >
                                <mat-label>Nombre Heure</mat-label>
                                <input matInput formControlName="nbre_heure" [(ngModel)]="honoraire.nbre_heure">
                                <mat-error>
                                    Nombre Heure obligatoire
                                </mat-error>
                            </mat-form-field>

                        </div>    
                        <div class="centerinput">
                            <mat-form-field  fxFlex="30" class="pl-4" appearance="outline" fxFlex style="width:620px;" >
                                <mat-label>Prix Unitaire</mat-label>
                                <input matInput formControlName="pu" [(ngModel)]="honoraire.pu">
                                <mat-error>
                                    Prix Unitaire obligatoire
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start start">
                            <button (click)="ajout_honoraire(honoraire,0)" mat-raised-button color="accent" class="submit-button ml-4" aria-label="CREATE AN FORM"
                                [disabled]="honoraireForm.invalid">
                                Enregistrer
                            </button>
                            <button (click)="annuler_produit()" mat-raised-button color="primary" aria-label="ANNULER AN FORM" class="ml-4">
                                ANNULER
                            </button>
                        </div>
                    </form>  
                </div>      
             </ng-template>   



        </div>

    </div>
    <!-- / CONTENT -->

</div>
